<!-- Credits https://github.com/ErikGartner/dTree-->
<!DOCTYPE html>
<meta charset="utf-8">

<style type="text/css">
	body {
	    font: 10px sans-serif;
	}
	.linage {
	    fill: none;
	    stroke: #000;
	}
	.marriage {
	    fill: none;
	    stroke: black;
	}
	.man {
	    background-color: lightblue;
			border-style: solid;
			border-width: 1px;
			box-sizing: border-box;
	}
	.woman {
			background-color: pink;
			border-style: solid;
			border-width: 1px;
			box-sizing: border-box;
	}
	.emphasis{
			font-style: italic;
	}
	p {
		padding:0;
		margin:0;
	}
	svg {
		border-style: solid;
		border-width: 1px;
	}
</style>

<script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="/dTree.js"></script>
<body>
		<h1>Demo</h1>
    <div id="graph"></div>

		<script>

			LoadFamilyTree();

				async function getRelations() {
					const relationRequest = await fetch("/stammbaum/beziehungen");
					const relations = await relationRequest.json();
					return relations;
				}

				async function LoadFamilyTree() {
					var hRelations = await getRelations();
					console.log(hRelations);
					FillDTreeWithRelations(hRelations)
				}
				
				function FillDTreeWithRelations(_relations) {
					dTree.init(_relations,
					{
						target: "#graph",
						debug: true,
						height: 800,
						width: 1200,
						callbacks: {
							nodeClick: function(name, extra) {
								alert('Click: ' + name);
							},
							nodeRightClick: function(name, extra) {
								alert('Right-click: ' + name);
							},
							textRenderer: function(name, extra, textClass) {
								if (extra && extra.nickname)
									name = name + " (" + extra.nickname + ")";
								return "<p align='center' class='" + textClass + "'>" + name + "</p>";
							}
						}
					});
				}
				
      	
    </script>
</body>
</html>